#!/bin/bash

# 定义颜色
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
LIGHTBLUE='\033[1;34m'
LIGHTCYAN='\033[1;36m'
NC='\033[0m' # No Color

# 自动安装脚本
auto_install() {
    # 目标脚本路径
    TARGET_SCRIPT=/root/vps666
    INSTALL_DIR="/usr/local/my_script"
    INSTALL_SCRIPT="$INSTALL_DIR/vps666"

    # 确保安装目录存在
    if [ ! -d "$INSTALL_DIR" ]; then
        echo -e "${YELLOW}警告：安装目录 $INSTALL_DIR 不存在，正在创建...${NC}"
        mkdir -p "$INSTALL_DIR"
    fi

    # 检查 /root/vps666 文件是否存在
    if [ -f "$TARGET_SCRIPT" ]; then
        echo -e "${GREEN}/root/vps666 文件存在，正在设置快捷指令 'm'...${NC}"
    else
        echo -e "${RED}/root/vps666 文件不存在，请确保文件已下载到该路径。${NC}"
        exit 1
    fi

    # 复制或替换脚本到安装目录
    if [ -f "$INSTALL_SCRIPT" ]; then
        echo -e "${YELLOW}已存在脚本文件，正在替换...${NC}"
    fi
    cp "$TARGET_SCRIPT" "$INSTALL_SCRIPT"
    echo -e "${GREEN}已将脚本复制到 $INSTALL_SCRIPT${NC}"

    # 确保 ~/.bashrc 文件存在且可写
    if [ ! -f ~/.bashrc ]; then
        echo -e "${RED}警告：~/.bashrc 文件不存在，正在创建...${NC}"
        touch ~/.bashrc
        chmod 644 ~/.bashrc  # 确保文件可写
    fi

    if [ ! -w ~/.bashrc ]; then
        echo -e "${RED}错误：~/.bashrc 文件不可写，请检查文件权限。${NC}"
        exit 1
    fi

    # 添加别名到 .bashrc（如果不存在）
    if ! grep -q "alias m='sudo $INSTALL_SCRIPT'" ~/.bashrc; then
        echo "alias m='sudo $INSTALL_SCRIPT'" >> ~/.bashrc
        echo -e "${GREEN}已将快捷命令 'm' 添加到 ~/.bashrc${NC}"
    else
        echo -e "${YELLOW}快捷命令 'm' 已存在，无需重复添加${NC}"
    fi

    # 确保别名立即生效
    source ~/.bashrc

    # 检查别名是否生效
    if alias m &>/dev/null; then
        echo -e "${GREEN}别名 'm' 成功生效！${NC}"
    else
        echo -e "${RED}别名 'm' 未生效，请检查 ~/.bashrc 文件。${NC}"
        echo -e "${YELLOW}提示：请手动执行 'source ~/.bashrc' 以使别名生效。${NC}"
        cat ~/.bashrc | tail -n 10  # 显示 .bashrc 的最后10行
    fi

    echo -e "${LIGHTCYAN}安装完成！现在你可以使用 'm' 命令直接启动脚本。${NC}"
    echo -e "${YELLOW}提示：如需在其他终端生效，请重新登录或手动执行 source ~/.bashrc${NC}"
}

# 获取脚本路径
SCRIPT_PATH=$(realpath "${BASH_SOURCE[0]}")
SCRIPT_DIR=$(dirname "$SCRIPT_PATH")

# 调用自动安装函数
auto_install
